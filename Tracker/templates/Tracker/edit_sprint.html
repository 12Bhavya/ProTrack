{% extends "Tracker/base.html" %}

{% block title %} Sprint Screen{% endblock %}

{% block content %}
		<h1>Sprint View</h1>

		<form action="{% url 'edit_sprint' sprint.id %}" method="post">
		    {% csrf_token %}
			<table onload="stat();">
				<tr style="display:none">
					<td> {{form.project}}</td>
				</tr>
				<tr>
					<th>Name :</th>
					<td>{{form.sname}}</td>
				</tr>
				<tr>
					<th>Start Date :</th>
					<td>  {{form.start_date}}</td>
				</tr>
				<tr>
					<th>End Date : </th>
					<td> {{form.end_date}}</td>
				</tr>
				<tr>
					<th>Status : </th>
					<td id = "td1" > {{sprint.status}}</td>
				</tr>
			</table>
		    <input type="submit" value="Submit" />
		</form>
		<h2>Sprint Tasks:</h2>
		<table class="taskpool">
			<tr>
				<th>Task Name</th>
				<th>Task State</th>
				<th>Task Assignee</th>
				<th>Task Points</th>
			</tr>
			
			{% for task in sprint.task_set.all %}
    			<tr>
    			<td><a href= "{% url 'edit_task' task.id %}">{{ task.tname }}</a></td>
    			<td>{{ task.get_state_display }}</td>
    			<td>{{ task.assign.fname }}</td>
    			<td>{{ task.tp }}</td>
    			</tr>
				
			<script type="text/javascript">
			var newvalues= function findStatus()
			{
				var i = 0;
				var j = 0;
				var statusflag = 0;
				i = i + task.getElementById("tp");
				if(task.getElementById("state") == 'Completed')
					j += task.getElementById("tp");
				return [i, j]
			}
			</script>
			
    		{% endfor %}
			<script type="text/javascript">
			var values = newvalues();
			var x = values[0];
			var y = values[1];
			var prop = y/x;
			var status = '';
			function stat()
			{
				if(prop >= 0.7)
					status = 'Green';
				else if(prop >= 0.4)
					status ='Yellow';
				else
					status ='Red'	;
					document.getElementById('td1')= status;
			}
			</script>
			
    	</table>
		<h2>Add task to this sprint</h2>
		<ul>
			{% for task in sprint.project.task_set.all %}
    			<li><a href= "{% url 'edit_task' task.id %}">{{ task.tname }}</a></li>
    		{% endfor %}
    	</ul>
	        <form>
			<button formaction="{% url 'sprintchart' sprint.id %}">Analysis</button>
		</form>
    	<a href="{% url 'delete_sprint' sprint.id %}" >Delete Sprint</a>
    	<br><a href="{% url 'edit_project' sprint.project.id %}" >Back</a>
{% endblock %}
