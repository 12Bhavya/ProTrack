{% extends "Tracker/base.html" %}

{% block title %} Sprint Screen{% endblock %}

{% block content %}
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
   <script src="http://code.highcharts.com/highcharts.js"></script>
   <script src="http://code.highcharts.com/highcharts-3d.js"></script>
<script>
    function openForm(divName) {
    var i;
    var x = document.getElementsByClassName("sprintdetails");
    for (i = 0; i < x.length; i++) {
        x[i].style.display = "none"; 
    }
    document.getElementById(divName).style.display = "block"; 
}
function confirmDelete(){
var result = confirm("Are you sure you want to delete this sprint?");
if (result == true) {
    window.location.href = "{% url 'delete_sprint' sprint.id %}";
}

}
</script>
    <div class= "container">
    <!--Task Table-->
        <div class = "row">
            <div class="col-md-8">
             <h3>Sprint Tasks</h3>
             {% if sprint.task_set.all %}
                <table class="taskpool">
			<tr>
				<th>Name</th>
				<th>State</th>
				<th>Assignee</th>
				<th>Task Points</th>
			</tr>
			
			{% for task in sprint.task_set.all %}
    			<tr>
    			<td><a href= "{% url 'edit_task' task.id  %}">{{ task.tname }}</a></td>
    			<td>{{ task.get_state_display }}</td>
    			<td>{{ task.assign}}</td>
    			<td>{{ task.tp }}</td>
    			</tr>
    		{% endfor %}	
    	</table>
            {% else %}
            No Tasks Added
            {% endif %}   
            
            </div>
            
        <!--Sprint Details-->
        <!--Edittable-->
        <div class = "col-md-3 sprint-details">
        <div id="edittable" class = "sprintdetails" style="display:none">
        <h3><span class="pull-left"><button class="btn btn-default" id="backbutton" onclick="openForm('not_edittable')" type="submit">
        <i class=" glyphicon glyphicon-circle-arrow-left"></i>
      </button></span>Sprint Details</h3>
        {% if form.errors %}
            <div class="text-danger">Error: End Date cannot be before Start Date</div>
        {% endif %}
		<form action="{% url 'edit_sprint' sprint.id  %}" method="post">
		    {% csrf_token %}
			<table>
				<tr>
					<td hidden> {{form.project}}</td>
				</tr>
				<tr>
					<th>Name </th>
					<td>{{form.sname}}</td>
				</tr>
				<tr>
					<th>Start Date </th>
					<td>  {{form.start_date}}</td>
				</tr>
				<tr>

					{% if form.errors %}
                    <div class="text-danger">
                    <th>End Date </th>
                    </div>
                    {% else %}
                    <th>End Date </th>
                    {% endif %}
                    
					<td> {{form.end_date}}</td>
				</tr>
				<tr>
					<th>Status </th>
					<td>{{st}}</td>
				</tr>
			</table>
		    <button class= "btn btn-sm btn-success" type="submit" value="Submit">Submit</button>
            <button onClick="confirmDelete()" class="btn btn-default" id="deletebutton" type="submit">
                    <i class=" glyphicon glyphicon-trash"></i>
            </button>
		</form>
        </div> <!--Edittable-->
        <!--Not Edittable-->
        <div id="not_edittable" class = "sprintdetails">
        <h3><span class="pull-right"><button class="btn btn-default" id="editbutton" onclick="openForm('edittable')" type="submit">
        <i class="glyphicon glyphicon-pencil"></i>
      </button></span>Sprint Details</h3> 
        <table>

				<tr>
					<th>Name </th>
					<td> {{sprint.sname}}</td>
				</tr>
                <tr>
					<th>Start Date </th>
					<td>  {{sprint.start_date|date:"j M Y"}}</td>
				</tr>
				<tr>
                <tr>
					<th>End Date </th>
					<td>  {{sprint.end_date|date:"j M Y"}}</td>
				</tr>
				<tr>
					<th>Status </th>
					<td>  {{st}}</td>
				</tr>
			</table>
        </div>
        
        </div> <!--Sprint Details-->
        </div> <!--1st Row-->
    	<!--<br><a href="{% url 'edit_project' sprint.project.id  %}" >Back</a>-->
        <div class="row">
                
        <div class="col-md-8">
        {% if errorchart == 0 %}
        <div id="Burndown" class="chartcard" style="height:400px;"></div>
        {% endif %}
        </div>
        <div class = "col-md-3 whitecard">
                        <h3>Add/Remove Tasks</h3>
                        <ul class="add-to-sprint">
			{% for task in sprint.project.task_set.all %}
                <form>
    			<li><a href= "{% url 'edit_task' task.id  %}">{{ task.tname }}</a> &nbsp 
                {% if task in sprint.task_set.all %}
                <button formaction="{% url 'tsr' task.id  sprint.id %}" class="btn btn-xs btn-danger sprintbtn"><span style="font-size:12px;" class="glyphicon glyphicon-minus-sign"></span>&nbsp;</button>
                {% else %}
                <button formaction="{% url 'ts' task.id  sprint.id %}" class="btn btn-xs btn-success sprintbtn"> <span style="font-size:12px;"class="glyphicon glyphicon-plus-sign"></span>&nbsp;</button>
                {% endif %}
                </li>
                </form>
			{% endfor %}
                </ul>
        </div>
            
        



    </div> <!-- Row--->
 
    </div> <!--Container-->
<script>

{% if errorchart == 0 %}
$(function () {
  $('#Burndown').highcharts({
    title: {
      text: 'Burndown Chart',
      x: -20 //center
    },
    colors: ['blue', 'red'],
    plotOptions: {
      line: {
        lineWidth: 3
      },
      tooltip: {
        hideDelay: 200
      }
    },
    /*subtitle: {
      text: 'Sprint 1',
      x: -20
    },*/
    xAxis: {
      categories: {{categories|safe}}
    },
    yAxis: {
      title: {
        text: 'Task Points'
      },
      plotLines: [{
        value: 0,
        width: 1
      }]
    },
    tooltip: {
      valueSuffix: ' TP',
      crosshairs: true,
      shared: true
    },
    legend: {
      layout: 'vertical',
      align: 'right',
      verticalAlign: 'middle',
      borderWidth: 0
    },
    series: [{
      name: 'Ideal Burn',
      color: 'rgba(255,0,0,0.25)',
      lineWidth: 2,
      data: {{idealdata}}
    }, {
      name: 'Actual Burn',
      color: 'rgba(0,120,200,0.75)',
      marker: {
        radius: 6
      },
      data: {{realdata}}
    }]
  });
});
{% endif %}

</script>
{% endblock %}
