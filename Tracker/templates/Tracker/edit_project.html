{% extends "Tracker/base.html" %}
{% block nav-project %} active {% endblock %}
{% block title %}{{project.pname}}{% endblock %}

{% block content %}
<script>
    function openForm(divName) {
    var i;
    var x = document.getElementsByClassName("projectdetails");
    for (i = 0; i < x.length; i++) {
        x[i].style.display = "none"; 
    }
    document.getElementById(divName).style.display = "block"; 
}
function confirmDelete(){
var result = confirm("Are you sure you want to delete this project?");
if (result == true) {
    window.location.href = "{% url 'delete_project' project.id %}";
}

}
</script>
    <div class= "container">
     <div class = "row">
        <div class="col-md-8">

		<h3>Tasks 
        <span class = "pull-right" >         
        <form>
			<button formaction="{% url 'add_task' project.id %}" class="btn btn-primary"> Add Task&nbsp; <span class="glyphicon glyphicon-plus"></span></button>
	    </form></span>
        </h3>
		<table class = "taskpool">
		<tr>
			<th>Name</th>
			<th>Due Date</th>

			<th>State</th>
			<th>Assignee</th>
			<th>Task Points</th>
		</tr>
	    	{% for task in project.task_set.all|dictsort:"created" %}
    			<tr>
	    			<td><a href= "{% url 'edit_task' task.id  %}">{{ task.tname }}</a></td>
	    			<td> {{task.due_date|date:"j M Y"}}</td> 
					<td> {{ task.get_state_display }}</td>
					<td> {{task.assign }}</td>
					<td> {{task.tp}}</td>
				</tr>
    		{% endfor %}
		</table>
		
		
		<h3>Sprints
        <span class = "pull-right" >         
        <form>
			<button formaction="{% url 'add_sprint' project.id %}" class="btn btn-primary"> Add Sprint&nbsp; <span class="glyphicon glyphicon-plus"></span></button>
	    </form></span>
        </h3>
        <table class = "taskpool">
		<tr>
			<th>Name</th>
			<th>Starts</th>
			<th>Ends</th>
            <th>Tasks</th>
		</tr>
	    	{% for sprint in project.sprint_set.all|dictsort:"start_date" %}
    			<tr>
	    			<td><a href= "{% url 'edit_sprint' sprint.id  %}">{{ sprint.sname }}</a></td>
	    			<td> {{sprint.start_date|date:"j M Y"}}</td> 
					<td> {{ sprint.end_date|date:"j M Y" }}</td>
                    <td> {{sprint.task_set.all.count}}</td>
				</tr>
    		{% endfor %}
		</table>
 
		


		<form>
			<button formaction="{% url 'chart' project.id %}">Analysis</button>
			<button formaction="{% url 'calendar' project.id  %}">Calendar View</button>
		</form>
        </div>
        
        
        <div class = "col-md-3 proj-details ">
        <!--Not Edittable-->
        <div id="not_edittable" class = "projectdetails">
        <h3><span class="pull-right"><button class="btn btn-default" id="editbutton" onclick="openForm('edittable')" type="submit">
        <i class="glyphicon glyphicon-pencil"></i>
      </button></span>Project Details</h3> 
        <table>

				<tr>
					<th>Name </th>
					<td> {{project.pname}}</td>
				</tr>
				<tr>
					<th>Description </th>
					<td>  {{project.pdesc}}</td>
				</tr>
                <tr>
					<th>Deadline </th>
					<td>  {{project.pdeadline|date:"j M Y"}}</td>
				</tr>
				<tr>
					<th>Status </th>
					<td>  {{ps}}</td>
				</tr>
			</table>
        </div>
        
        <!--Not Edittable-->
        
        <!--Edittable-->
        <div id="edittable" class = "projectdetails" style="display:none">
        <h3><span class="pull-left"><button class="btn btn-default" id="backbutton" onclick="openForm('not_edittable')" type="submit">
        <i class=" glyphicon glyphicon-circle-arrow-left"></i>
      </button></span>Project Details</h3>
		<form action="{% url 'edit_project' project.id %}" method="post">
		    {% csrf_token %}
			<table>
				<tr>
					<td hidden> {{form.pgroup}}</td>
				</tr>
				<tr>
					<th>Name </th>
					<td>{{form.pname}}</td>
				</tr>
				<tr>
					<th>Description </th>
					<td>  {{form.pdesc}}</td>
				</tr>
                <tr>
					<th>Deadline </th>
					<td>  {{form.pdeadline}}</td>
				</tr>
				<tr>
					<th>Status </th>
					<td>  {{ps}}</td>
				</tr>
			</table>
			<button class= "btn btn-success" type="submit" value="Submit">Submit</button>
            <button onClick="confirmDelete()" class="btn btn-default" id="deletebutton" type="submit">
        <i class=" glyphicon glyphicon-trash"></i>
      </button>
		</form>
        </div>
		
       
        </div>

           <div id = "search-tag-card" class = "col-md-3 proj-details ">
           <h4>Search Tasks by Tags</h4>
           <form method="POST" action="/Tracker/search_tag/">
			{% csrf_token %}
			    
                    <input type="text"  placeholder="Search" name="textfield" style="font-size:16px;">
                        
                        <button class="btn btn-default" type="submit">
                        <i class="glyphicon glyphicon-search" style="font-size:14px;"></i>
                        </button>


            </form>
            </div>        
      </div>
    </div>
{% endblock %}
