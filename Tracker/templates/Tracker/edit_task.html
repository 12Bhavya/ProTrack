{% extends "Tracker/base.html" %}
{% block nav-project %} active {% endblock %}
{% block title %} Task Screen{% endblock %}
{% load my_tags %}

{% block content %}
<script>
    function openForm(divName) {
    var i;
    var x = document.getElementsByClassName("taskdetails");
    for (i = 0; i < x.length; i++) {
        x[i].style.display = "none"; 
    }
    document.getElementById(divName).style.display = "block"; 
}
function confirmDelete(){
var result = confirm("Are you sure you want to delete this task?");
if (result == true) {
    window.location.href = "{% url 'delete_task' task.id %}";
}

}

</script>
<div class= "container project-content">

    <div class = "row">
        <!-- NOT EDITTABLE -->
         <div class = "col-md-8">
        <div id="not_edittable" class = "whitecard taskdetails">
        <h3><span class="pull-right"><button class="btn btn-default" id="editbutton" onclick="openForm('edittable')" type="submit">
        <i class="glyphicon glyphicon-pencil"></i>
      </button></span>Task Details</h3> 
        <table class="task-details">

				<tr>
					<th>Name </th>
					<td> {{task.tname}}</td>
				</tr>
                <tr>
					<th>Description&nbsp; </th>
					<td> {{ task.desc }}</td>
				</tr>
                
                
				<tr><th>Due Date </th><td> {{task.due_date}} ({% if days >= 0 %}{{days}} Day{% if days > 1 %}s{% endif %}
                    left{% else %}Task is Overdue{% endif %})
                    </td></tr>

				{% if task.risk%}<tr><th>Risk </th><td>  {{ task.risk }}</td></tr>{% endif %}
				<tr><th>Priority </th><td> {{ task.priority }}</td></tr>
				<tr><th>State </th><td> {{ task.state }}</td></tr>
				<tr><th>Assignee </th><td> {{task.assign }}</td>
				{% if task.remainder%}<tr><th>Remainder </th><td> {{task.remainder}}</td></tr>{% endif %}
				{% if task.heading%}<tr><th>Heading </th><td> {{task.heading}}</td></tr>{% endif %}
				{% if task.dep_task%}<tr><th>Dependent Task &nbsp;</th><td> {{task.dep_task}}</td></tr>{% endif %}
				<tr><th>Task Points </th><td> {{task.tp}}</td></tr>
			</table>
        </div>
        
        <!-- EDITTABLE -->
        <div id="edittable" class = "taskdetails whitecard " style="display:none">
        <h3><span class="pull-left"><button class="btn btn-default" id="backbutton" onclick="openForm('not_edittable')" type="submit">
        <i class=" glyphicon glyphicon-circle-arrow-left"></i>
      </button></span>Edit Task Details</h3>
		<form action="{% url 'edit_task' task.id  %}" method="post">
			{% csrf_token %}
			<table>
				<tr>
					<td  hidden>{{form.tproject}}</td>

				<tr>
                    <td hidden>{{form.tsprint}}</td>
				</tr>
				<tr>
					<th>Name </th>
					<td> {{ form.tname }}</td>
				</tr>

				</tr>            
				<tr>
					<th>Description </th>
					<td> {{ form.desc }}</td>
				</tr>
                
                
				<tr><th>Due Date </th><td> {{form.due_date}}</td></tr>
				<tr><th>Risk </th><td>  {{ form.risk }}</td></tr>
				<tr><th>Priority </th><td> {{ form.priority }}</td></tr>
				<tr><th>State  </th><td> {{ form.state }}</td></tr>
				<tr><th>Assignee </th><td> {{task.assign }}</td><td hidden> {{form.assign }}</td></tr>
				<tr><th>Remainder </th><td> {{form.remainder}}</td></tr>
				<tr><th>Heading </th><td> {{form.heading}}</td></tr>
				<tr><th>Dependent Task &nbsp;</th><td> {{form.dep_task}}</td></tr>
				<tr><th>Task Points </th><td> {{form.tp}}</td></tr>
			</table>
            <button class= "btn btn-sm btn-success" type="submit" value="Submit" name="edittask">Submit</button>
            <button onClick="confirmDelete()" class="btn btn-default" id="deletebutton" type="submit">
                    <i class=" glyphicon glyphicon-trash"></i>
            </button>
		</form>

        </div>
        </div>
       <!-- TAGS FOR THIS TASK-->
        <div class="col-md-3">
         <div class ="tag whitecard">
        <div class = "listtags">
		<h3>Task Tags</h3>
		{% if error_message %}
			<p>{{ error_message }}</p>
		{% endif %}
		{% for c in task.tag_set.all %}
    		<span class = "tags">{{ c.tag }}</span>
		{% endfor %}
        </div>
        <form action="{% url 'edit_task' task.id %}" method="post">
			{% csrf_token %}
			<table>
		    	<tr>
					<td hidden>{{formt.task}}</td>
				</tr>
                </table>

					<p class = "addtag">{{formt.tag}}</p>



        <button class= "btn btn-xs btn-primary" type="submit" value="Submit" name="edittask">Add Tag</button>
        </form>
        </div>
        </div>

	<!-- COMMENTS FOR THIS TASK-->	
        <div class = "col-md-8">
		<h3>Comments</h3>
		{% if error_message %}
			<p>{{ error_message }}</p>
		{% endif %}
        <div class="commentdiv">
        
		{% for c in task.comment_set.all|dictsort:"ccreated"%}
            <div class = "commentcard">
			<p class = "commentinfo"><span class = "commentname"><strong>{{c.member.first_name}} {{c.member.last_name}}</strong></span> <span class="commentuname">@{{c.member.username}}</span> &#183;<span class = "commentdate"> {{ c.ccreated|timesince|upto:','}} ago </span> </p>
            <p class = "commentcontent">{{c.comment}}</p>
            
            </div>
		{% endfor %}
        </div>
		<form action="{% url 'edit_task' task.id %}" method="post">
			{% csrf_token %}
			<table>
				<tr>
					<td hidden>{{formc.task}}</td>
				</tr>
				<tr>
					<td hidden>{{formc.member}}</td>
				</tr>
				</table>
                 <p>{{formc.comment}}</p>
					<button type="submit" name="commenttask" class="btn btn-sm btn-primary">Comment</button>
		</form>
        </div>


        </div>
        </div>
{% endblock %}